<!DOCTYPE html>
<html>

<link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
<title>Smarty smart</title>
<script src="{{ url_for('static', filename='vanilla-picker.js') }}"></script>
<head>
    <style>
.grid-rgb {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr 1fr;
    margin-top: 15px;
}
.color-item {
border:0px solid #fff;
    width: 100%;
    height: 100px;
    font-size: 0px;
}
.button {
    width: 100%;
    max-width: 800px;
    margin: 6px;
    background-color:transparent;
    -moz-border-radius:14px;
    -webkit-border-radius:14px;
    border-radius:14px;
    border:1px solid #fff;
    display:inline-block;
    cursor:pointer;
    color:#fff;
    font-family:arial, Helvetica, sans-serif, light;
    font-size:36px;
    padding:22px 31px;
    text-decoration:none;
    text-shadow:0px 0px 0px #707070;
    opacity: 0.9;
}
.button:hover {
    background-color:#27272f;
}

#main-color {
    display: inline-block;
}
#main-color .picker_sample, #main-color .picker_done {
    display: none;
}



    </style>
</head>
<body style="text-align: center; background: #17171f">

<div class="container">
    <div>
        <form action="/" method="get">
            <input class="button" type="submit" value="back"/>
        </form>
    </div>
</div>

<div id="main-color"></div>

<script>
        var parentMain = document.querySelector('#main-color');

        // Returns a function, that, as long as it continues to be invoked, will not
        // be triggered. The function will be called after it stops being called for
        // N milliseconds. If `immediate` is passed, trigger the function on the
        // leading edge, instead of the trailing.
        function debounce(func, wait, immediate) {
            var timeout;
            return function() {
                var context = this, args = arguments;
                var later = function() {
                    timeout = null;
                    if (!immediate) func.apply(context, args);
                };
                var callNow = immediate && !timeout;
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
                if (callNow) func.apply(context, args);
            };
        };

        async function updateBackground(color) {
            var rgbColor = color.hex.substring(1, 7);
            var data = new URLSearchParams();
            data.append('rgb', rgbColor);
            await fetch('{{ url_for('rgb') }}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8'
                },
                body: data
            })
        }

        var debouncedUpdateBackground = debounce(updateBackground, 500);

        new Picker({
            parent: parentMain,
            popup: false,
            alpha: false,
            editor: false,
            color: '#{{ controller.get_led_color() }}',
            onChange: function(color) {
                debouncedUpdateBackground(color);
            },
        });


</script>


</body>
</html>
